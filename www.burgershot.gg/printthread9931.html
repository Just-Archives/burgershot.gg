<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><!-- start: printthread -->
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<title> Math: vertical viewing angle - Printable Version</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<style type="text/css">
body { font-family: Verdana, Arial, sans-serif; font-size: 13px; }
.largetext { font-family: Verdana, Arial, sans-serif; font-size: medium; font-weight: bold; }
img { max-width: 100%; height: auto; }
</style>
</head>
<body>
<table width="98%" align="center">
<tr>
<td valign="top"><a href="index-2.html"><img src="images/emerald/logo.html" alt="Burgershot" title="Burgershot" border="0" /></a></td>
</tr>
<tr>
<td>
<span class="largetext"> <a href="showthread9931.html?tid=721">Math: vertical viewing angle</a> - Printable Version</span><br />
<br />
+- Burgershot (<em>https://www.burgershot.gg</em>)<br />
<!-- start: printthread_nav -->
+-- Forum: General (<i>https://www.burgershot.gg/forumdisplay.php?fid=19</i>)<br />
<!-- end: printthread_nav --><!-- start: printthread_nav -->
+--- Forum: Programming (<i>https://www.burgershot.gg/forumdisplay.php?fid=56</i>)<br />
<!-- end: printthread_nav -->
+--- Thread:  Math: vertical viewing angle (<em>/showthread.php?tid=721</em>)<br />
<br />
</td>
</tr>
<tr>
<td><br /><hr size="1" /><!-- start: printthread_post -->
<strong>Math: vertical viewing angle</strong> - <a href="member9b55.html?action=profile&amp;uid=11">Freaksken</a> -  <strong>2019-07-15</strong>
<br />
<br />
I have a system in which I've worked out the code for giving an NPC a horizontal viewing angle (left image). How would I achieve a similar result, but now for the vertical direction (right image)?<br />
<img src="https://www.dropbox.com/s/tl2biem7emg13be/viewing_angle.png?raw=1" loading="lazy"  alt="[Image: viewing_angle.png?raw=1]" class="mycode_img" /><br />
<br />
Below is the code for the left image, for reference. This is a math question, thus the code isn't really necessary, but might help you understand the problem. Just ignore that the angles start from the NPC's center instead of his eyes, that's easy enough to fix. As you can see, the z-position is irrelevant for the horizontal viewing angle, but probably not for the vertical viewing angle (not sure).<br />
<div class="codeblock phpcodeblock"><div class="title">PHP Code:</div><div class="body"><div dir="ltr"><code><span style="color: #007700">static&nbsp;</span><span style="color: #0000BB">bool</span><span style="color: #007700">:</span><span style="color: #0000BB">FAI_IsPlayerInAggroViewingAngle</span><span style="color: #007700">(</span><span style="color: #0000BB">playerid</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">npcid</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Get&nbsp;NPC&nbsp;position<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">new&nbsp;</span><span style="color: #0000BB">Float</span><span style="color: #007700">:</span><span style="color: #0000BB">xn</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">Float</span><span style="color: #007700">:</span><span style="color: #0000BB">yn</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">Float</span><span style="color: #007700">:</span><span style="color: #0000BB">zn</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">FCNPC_GetPosition</span><span style="color: #007700">(</span><span style="color: #0000BB">npcid</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">xn</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">yn</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">zn</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Get&nbsp;player&nbsp;position<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">new&nbsp;</span><span style="color: #0000BB">Float</span><span style="color: #007700">:</span><span style="color: #0000BB">xp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">Float</span><span style="color: #007700">:</span><span style="color: #0000BB">yp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">Float</span><span style="color: #007700">:</span><span style="color: #0000BB">zp</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">IsPlayerNPC</span><span style="color: #007700">(</span><span style="color: #0000BB">playerid</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">GetPlayerPos</span><span style="color: #007700">(</span><span style="color: #0000BB">playerid</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">xp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">yp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">zp</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">FCNPC_GetPosition</span><span style="color: #007700">(</span><span style="color: #0000BB">playerid</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">xp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">yp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">zp</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Calculate&nbsp;the&nbsp;angle&nbsp;between&nbsp;these&nbsp;2&nbsp;points<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">new&nbsp;</span><span style="color: #0000BB">Float</span><span style="color: #007700">:</span><span style="color: #0000BB">angleBetweenPoints&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">atan2</span><span style="color: #007700">(</span><span style="color: #0000BB">xp&nbsp;</span><span style="color: #007700">-&nbsp;</span><span style="color: #0000BB">xn</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">yp&nbsp;</span><span style="color: #007700">-&nbsp;</span><span style="color: #0000BB">yn</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Get&nbsp;the&nbsp;NPC&nbsp;facing&nbsp;angle&nbsp;adjusted&nbsp;for&nbsp;the&nbsp;weird&nbsp;GTA&nbsp;angle&nbsp;system<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">new&nbsp;</span><span style="color: #0000BB">Float</span><span style="color: #007700">:</span><span style="color: #0000BB">npcFacingAngle&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">360.0&nbsp;</span><span style="color: #007700">-&nbsp;</span><span style="color: #0000BB">FCNPC_GetAngle</span><span style="color: #007700">(</span><span style="color: #0000BB">npcid</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Calculate&nbsp;the&nbsp;smallest&nbsp;difference&nbsp;between&nbsp;these&nbsp;2&nbsp;angles&nbsp;as&nbsp;a&nbsp;value&nbsp;between&nbsp;-180.0&nbsp;and&nbsp;180.0<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">new&nbsp;</span><span style="color: #0000BB">Float</span><span style="color: #007700">:</span><span style="color: #0000BB">angleDifference&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">angleBetweenPoints&nbsp;</span><span style="color: #007700">-&nbsp;</span><span style="color: #0000BB">npcFacingAngle</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">angleDifference&nbsp;</span><span style="color: #007700">&gt;&nbsp;</span><span style="color: #0000BB">180.0</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">angleDifference&nbsp;</span><span style="color: #007700">-=&nbsp;</span><span style="color: #0000BB">360.0</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">angleDifference&nbsp;</span><span style="color: #007700">&lt;&nbsp;-</span><span style="color: #0000BB">180.0</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">angleDifference&nbsp;</span><span style="color: #007700">+=&nbsp;</span><span style="color: #0000BB">360.0</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Get&nbsp;the&nbsp;absolute&nbsp;value&nbsp;of&nbsp;this&nbsp;angle<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">angleDifference&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">floatabs</span><span style="color: #007700">(</span><span style="color: #0000BB">angleDifference</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Check&nbsp;if&nbsp;the&nbsp;player&nbsp;is&nbsp;within&nbsp;the&nbsp;aggro&nbsp;viewing&nbsp;angle<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">angleDifference&nbsp;</span><span style="color: #007700">&lt;=&nbsp;</span><span style="color: #0000BB">FAI_NPCs</span><span style="color: #007700">[</span><span style="color: #0000BB">npcid</span><span style="color: #007700">][</span><span style="color: #0000BB">FAI_NPC_AGGRO_VIEWING_ANGLE</span><span style="color: #007700">][</span><span style="color: #0000BB">playerid</span><span style="color: #007700">]/</span><span style="color: #0000BB">2</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />}&nbsp;<br /></span></code></div></div></div><br />
Here's another visualisation of what the result should look like:<br />
<img src="https://www.dropbox.com/s/zwvw8zn9i422xdf/viewing_angle2.png?raw=1" loading="lazy"  alt="[Image: viewing_angle2.png?raw=1]" class="mycode_img" />
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
<strong>RE: Math: vertical viewing angle</strong> - <a href="member262c.html?action=profile&amp;uid=359">hiddos</a> -  <strong>2019-07-15</strong>
<br />
<br />
An alternative way of doing both of these together is through some vector calculations. You want to essentially do step 3 of the image below:<br />
<br />
<br />
<img src="https://www.analyzemath.com/stepbystep_mathworksheets/3D_vectors/angle_vectors.png" loading="lazy"  alt="[Image: angle_vectors.png]" class="mycode_img" /><br />
<br />
Some rough code (that I didn't test for accuracy) would look like:<br />
<br />
<div class="codeblock phpcodeblock"><div class="title">PHP Code:</div><div class="body"><div dir="ltr"><code><span style="color: #0000BB">new Float</span><span style="color: #007700">:</span><span style="color: #0000BB">xn</span><span style="color: #007700">,</span><span style="color: #0000BB"> Float</span><span style="color: #007700">:</span><span style="color: #0000BB">yn</span><span style="color: #007700">,</span><span style="color: #0000BB"> Float</span><span style="color: #007700">:</span><span style="color: #0000BB">zn</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">FCNPC_GetPosition</span><span style="color: #007700">(</span><span style="color: #0000BB">npcid</span><span style="color: #007700">,</span><span style="color: #0000BB"> xn</span><span style="color: #007700">,</span><span style="color: #0000BB"> yn</span><span style="color: #007700">,</span><span style="color: #0000BB"> zn</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Get player position<br /></span><span style="color: #0000BB">new Float</span><span style="color: #007700">:</span><span style="color: #0000BB">xp</span><span style="color: #007700">,</span><span style="color: #0000BB"> Float</span><span style="color: #007700">:</span><span style="color: #0000BB">yp</span><span style="color: #007700">,</span><span style="color: #0000BB"> Float</span><span style="color: #007700">:</span><span style="color: #0000BB">zp</span><span style="color: #007700">;<br />if(!</span><span style="color: #0000BB">IsPlayerNPC</span><span style="color: #007700">(</span><span style="color: #0000BB">playerid</span><span style="color: #007700">))</span><span style="color: #0000BB"> </span><span style="color: #007700">{<br /></span><span style="color: #0000BB">  &nbsp;GetPlayerPos</span><span style="color: #007700">(</span><span style="color: #0000BB">playerid</span><span style="color: #007700">,</span><span style="color: #0000BB"> xp</span><span style="color: #007700">,</span><span style="color: #0000BB"> yp</span><span style="color: #007700">,</span><span style="color: #0000BB"> zp</span><span style="color: #007700">);<br />}</span><span style="color: #0000BB"> else </span><span style="color: #007700">{<br /></span><span style="color: #0000BB">   &nbsp;FCNPC_GetPosition</span><span style="color: #007700">(</span><span style="color: #0000BB">playerid</span><span style="color: #007700">,</span><span style="color: #0000BB"> xp</span><span style="color: #007700">,</span><span style="color: #0000BB"> yp</span><span style="color: #007700">,</span><span style="color: #0000BB"> zp</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;First&nbsp;the&nbsp;vector&nbsp;from&nbsp;the&nbsp;NPC&nbsp;to&nbsp;the&nbsp;player<br /></span><span style="color: #0000BB">Float</span><span style="color: #007700">:</span><span style="color: #0000BB">vector_diff</span><span style="color: #007700">[</span><span style="color: #0000BB">3</span><span style="color: #007700">]&nbsp;=&nbsp;{</span><span style="color: #0000BB">xp</span><span style="color: #007700">-</span><span style="color: #0000BB">xn</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">yp</span><span style="color: #007700">-</span><span style="color: #0000BB">yn</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">zp</span><span style="color: #007700">-</span><span style="color: #0000BB">zn</span><span style="color: #007700">};<br /><br /><br /></span><span style="color: #0000BB">Float</span><span style="color: #007700">:</span><span style="color: #0000BB">facing_angle&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">FCNPC_GetAngle</span><span style="color: #007700">(</span><span style="color: #0000BB">npcid</span><span style="color: #007700">)&nbsp;+&nbsp;</span><span style="color: #0000BB">90</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;add&nbsp;90&nbsp;degrees&nbsp;to&nbsp;align&nbsp;with&nbsp;unit&nbsp;circle<br />//&nbsp;Then&nbsp;a&nbsp;unit&nbsp;vector&nbsp;for&nbsp;the&nbsp;angle&nbsp;the&nbsp;NPC&nbsp;is&nbsp;facing&nbsp;-&nbsp;nb.&nbsp;norm&nbsp;of&nbsp;this&nbsp;vector&nbsp;does&nbsp;not&nbsp;matter,&nbsp;but&nbsp;for&nbsp;unit&nbsp;vectors&nbsp;it's&nbsp;1<br /></span><span style="color: #0000BB">Float</span><span style="color: #007700">:</span><span style="color: #0000BB">vector_facing</span><span style="color: #007700">[</span><span style="color: #0000BB">3</span><span style="color: #007700">]&nbsp;=&nbsp;{</span><span style="color: #0000BB">floatcos</span><span style="color: #007700">(</span><span style="color: #0000BB">facing_angle</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">floatsin</span><span style="color: #007700">(</span><span style="color: #0000BB">facing_angle</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">0.0f</span><span style="color: #007700">};<br /><br /></span><span style="color: #FF8000">//&nbsp;Calculate&nbsp;the&nbsp;dot&nbsp;product,&nbsp;to&nbsp;get&nbsp;the&nbsp;numerator:&nbsp;<br /></span><span style="color: #0000BB">Float</span><span style="color: #007700">:</span><span style="color: #0000BB">dot_product&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">vector_diff</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]&nbsp;*&nbsp;</span><span style="color: #0000BB">vector_facing</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]&nbsp;+&nbsp;<br /></span><span style="color: #0000BB">        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp;vector_diff</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]&nbsp;*&nbsp;</span><span style="color: #0000BB">vector_facing</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]&nbsp;+&nbsp;<br /></span><span style="color: #0000BB">          &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp;vector_diff</span><span style="color: #007700">[</span><span style="color: #0000BB">2</span><span style="color: #007700">]&nbsp;*&nbsp;</span><span style="color: #0000BB">vector_facing</span><span style="color: #007700">[</span><span style="color: #0000BB">2</span><span style="color: #007700">];<br /><br /></span><span style="color: #FF8000">//&nbsp;Calculate&nbsp;the&nbsp;denominator<br /></span><span style="color: #0000BB">Float</span><span style="color: #007700">:</span><span style="color: #0000BB">normcalc&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">VectorSize</span><span style="color: #007700">(</span><span style="color: #0000BB">vector_diff</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">vector_diff</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">vector_diff</span><span style="color: #007700">[</span><span style="color: #0000BB">2</span><span style="color: #007700">]);&nbsp;</span><span style="color: #FF8000">//&nbsp;VectorSize(vector_facing)&nbsp;=&nbsp;1,&nbsp;so&nbsp;multiplication&nbsp;is&nbsp;not&nbsp;needed&nbsp;in&nbsp;this&nbsp;special&nbsp;case<br /><br />//Then&nbsp;this&nbsp;is&nbsp;the&nbsp;angle&nbsp;between&nbsp;the&nbsp;facing&nbsp;angle&nbsp;and&nbsp;the player<br /></span><span style="color: #0000BB">Float</span><span style="color: #007700">:</span><span style="color: #0000BB">angle&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">acos</span><span style="color: #007700">(</span><span style="color: #0000BB">dot_product</span><span style="color: #007700">/</span><span style="color: #0000BB">normcalc</span><span style="color: #007700">);<br /><br />return&nbsp;</span><span style="color: #0000BB">angle&nbsp;</span><span style="color: #007700">&lt;=&nbsp;</span><span style="color: #0000BB">max_viewing_angle</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;Insert&nbsp;your&nbsp;own&nbsp;variable&nbsp;here&nbsp;<br /></span></code></div></div></div>
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
<strong>RE: Math: vertical viewing angle</strong> - <a href="member9b55.html?action=profile&amp;uid=11">Freaksken</a> -  <strong>2019-07-15</strong>
<br />
<br />
An idea I had myself, was to (imagining) a rotation of the coordinate system around the y-axis, so that the same code I gave could work with now x = z and y = y. However, that doesn't seem to work when the NPC has any other rotation than 0.0 degrees.
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
<strong>RE: Math: vertical viewing angle</strong> - <a href="member262c.html?action=profile&amp;uid=359">hiddos</a> -  <strong>2019-07-16</strong>
<br />
<br />
Something I overlooked in my answer: getting the absolute value of the angle is not necessary as the range out arccos is [0-180] (or [0-pi]). As such I've edited the post
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
<strong>RE: Math: vertical viewing angle</strong> - <a href="member9b55.html?action=profile&amp;uid=11">Freaksken</a> -  <strong>2019-08-15</strong>
<br />
<br />
I brushed up on my maths knowledge and now understand your solution (and how simple it actually is). Thnx again!
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --></td>
</tr>
</table>
</body>
</html>
<!-- end: printthread -->