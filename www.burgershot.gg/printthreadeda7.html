<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><!-- start: printthread -->
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<title>Suggestion Population Sync - Printable Version</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<style type="text/css">
body { font-family: Verdana, Arial, sans-serif; font-size: 13px; }
.largetext { font-family: Verdana, Arial, sans-serif; font-size: medium; font-weight: bold; }
img { max-width: 100%; height: auto; }
</style>
</head>
<body>
<table width="98%" align="center">
<tr>
<td valign="top"><a href="index-2.html"><img src="images/emerald/logo.html" alt="Burgershot" title="Burgershot" border="0" /></a></td>
</tr>
<tr>
<td>
<span class="largetext"><span style="font-weight: bold;color: #a5a5ff;">[Suggestion]</span> <a href="showthreadeda7.html?tid=1177">Population Sync</a> - Printable Version</span><br />
<br />
+- Burgershot (<em>https://www.burgershot.gg</em>)<br />
<!-- start: printthread_nav -->
+-- Forum: open.mp (<i>https://www.burgershot.gg/forumdisplay.php?fid=40</i>)<br />
<!-- end: printthread_nav --><!-- start: printthread_nav -->
+--- Forum: Questions and Suggestions (<i>https://www.burgershot.gg/forumdisplay.php?fid=42</i>)<br />
<!-- end: printthread_nav -->
+--- Thread: <span style="font-weight: bold;color: #a5a5ff;">[Suggestion]</span> Population Sync (<em>/showthread.php?tid=1177</em>)<br />
<br />
</td>
</tr>
<tr>
<td><br /><hr size="1" /><!-- start: printthread_post -->
<strong>Population Sync</strong> - <a href="member81f8.html?action=profile&amp;uid=340">Sasino97</a> -  <strong>2020-09-09</strong>
<br />
<br />
<span style="font-weight: bold;" class="mycode_b"><span style="font-size: x-large;" class="mycode_size">Population Sync</span></span><br />
<br />
<span style="font-size: x-small;" class="mycode_size">I am not sure whether this has been suggested before, however after a quick forum search I didn't find anything like this.</span><br />
<br />
It would just be a great thing to have the default San Andreas population while playing online!<br />
<br />
<br />
<br />
<span style="font-weight: bold;" class="mycode_b"><span style="font-size: large;" class="mycode_size">How would it work?</span></span><br />
<br />
Every client will just let the GTA:SA default population spawning logic be, and for each ped that is spawned by it, sync it with the server. When two clients are close to each-other, an algorithm selects the client in charge to sync the population. The peds will also be automatically transferable from a client to another based on latency and other variables. <br />
<br />
Basically, the client with the best conditions (I will call it master) creates the peds, gets their info (skin, position, speed, animations, weapons, and everything), and sends that info to the server.<br />
<br />
The other clients (I will call them slaves) will simply get this data from the server, and create simple peds that don't follow the logic of their own game, but instead, use the received data. Every single ped will have a unique id on the server. <br />
<br />
In the case of ped driving vehicles, every time the client generates a vehicle for a ped to drive, it will inform the server, which will then keep track of that vehicle until the ped despawns.<br />
<br />
<br />
<br />
<span style="font-weight: bold;" class="mycode_b">TL;DR</span> Basically, like in FiveM.<br />
<br />
<br />
<br />
<span style="font-weight: bold;" class="mycode_b"><span style="font-size: large;" class="mycode_size">Server functions and callbacks</span></span><br />
<br />
Notice: This is just a prototype, and functions might be incorrect (e.g. I didn't use output/reference params nor return tags to simplify reading).<br />
<br />
<div class="codeblock"><div class="title">Code:</div><div class="body" dir="ltr"><code>// enable or disable the feature altogether (if disabled, peds will not be generated by the clients' games)<br />
<br />
TogglePopulation(bool:toggle);<br />
<br />
<br />
<br />
// sets the density multiplier of population for all players<br />
<br />
// 1.0 = default (1x)<br />
<br />
SetPopulationDensity(Float:density);<br />
<br />
<br />
<br />
// given a certain client, gets all the peds that are streamed in for it<br />
<br />
GetPlayerStreamedPeds(playerid);<br />
<br />
<br />
<br />
// given a certain client, gets all the peds that are being controlled by it<br />
<br />
GetPlayerOwnedPeds(playerid);<br />
<br />
<br />
<br />
// will get all peds that are known to the server<br />
<br />
GetAllPeds();<br />
<br />
// returns whether a ped is valid<br />
IsValidPed(Ped:ped);<br />
<br />
// gets a ped's owner (player)<br />
GetPedOwner(Ped:ped);<br />
<br />
// gets the ped pool's size<br />
GetPedPoolSize();<br />
<br />
<br />
<br />
// gets a ped's position<br />
<br />
GetPedPosition(Ped:ped);<br />
<br />
// gets a ped's facing angle<br />
GetPedFacingAngle(Ped:ped);<br />
<br />
<br />
<br />
// gets a ped's vehicle<br />
<br />
GetPedVehicleId(Ped:ped);<br />
<br />
// gets the ped's current weapon<br />
GetPedWeapon(Ped:ped);<br />
<br />
// returns whether a certain ped is streamed-in (visible) for a certain player<br />
IsPedStreamedIn(Ped:ped, playerid);<br />
<br />
// gets a ped's skin model<br />
GetPedSkin(Ped:ped);<br />
<br />
// gets a ped's interior<br />
GetPedInterior(Ped:ped);<br />
<br />
// gets a ped's health<br />
GetPedHealth(Ped:ped);<br />
<br />
// gets a ped's body armor<br />
GetPedArmour(Ped:ped);<br />
<br />
// gets a ped's [url=https://www.grandtheftwiki.com/Ped_Type]type[/url]<br />
// eg: CIVMALE or COP<br />
// could be used to check whether a ped is a cop for example<br />
GetPedType(Ped:ped);<br />
<br />
// gets a ped's [url=https://gtamods.com/wiki/Pedstats.dat]stats[/url]<br />
// eg: STAT_TOUGH_GUY or STAT_TAXIDRIVER<br />
GetPedStats(Ped:ped);<br />
<br />
// gets a ped's vehicle id<br />
GetPedVehicleId(Ped:ped);<br />
<br />
// gets a ped's velocity<br />
GetPedVelocity(Ped:ped);<br />
<br />
// gets a ped's weapon skill level<br />
GetPedSkillLevel(Ped:ped, skill);<br />
<br />
// gets a ped's current animation index<br />
GetPedAnimationIndex(Ped:ped);<br />
<br />
<br />
<br />
//-------------- callbacks ---------------<br />
<br />
// called when a ped was created/spawned<br />
// creatorid is the player that synced the ped for the first time<br />
// in a subsequent step, that ped's ownership may have been transferred to another player<br />
OnPedSpawn(Ped:ped, creatorid);<br />
<br />
// called when a ped has died<br />
// killerType is either "ped" or "player" (or none), and killerid contains the id of one of those two entities<br />
OnPedDeath(Ped:ped, killerType, killerid, reason);<br />
<br />
// called when a ped enters a vehicle<br />
OnPedEnterVehicle(Ped:ped, vehicleid);<br />
<br />
// called when a ped exits a vehicle<br />
OnPedExitVehicle(Ped:ped, vehicleid);<br />
<br />
// called when a ped is streamed in for a player<br />
OnPedStreamIn(Ped:ped, forplayerid);<br />
<br />
// called when a ped is streamed out for a player<br />
OnPedStreamOut(Ped:ped, forplayerid);<br />
<br />
// called when a ped gives damage to another ped or player<br />
OnPedGiveDamage(Ped:ped, damagedType, damagedId, Float: amount, weaponid, bodypart);<br />
<br />
// called when a ped gives damage to another ped or player<br />
OnPedTakeDamage(Ped:ped, issuerType, issuerid, Float: amount, weaponid, bodypart);</code></div></div><br />
<br />
That's pretty much everything that came to my mind at this moment. Of course more functions could be made.<br />
<br />
What do you guys think of this suggestion? Think about how radically differents servers will be with population in them :)
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
<strong>RE: Population Sync</strong> - <a href="memberc8dd.html?action=profile&amp;uid=221">Manyula</a> -  <strong>2020-09-11</strong>
<br />
<br />
If I remember correctly, the main reason why we got recorded NPCs was because Kalcor didn't want to put ped sync into the hands of the clients, and since the server doesn't run an instance of the game there would be no other way to sync them. I guess, we have two options:<br />
<br />
1. Letting the clients sync the peds lets us use the game's existing ped AI, so we as a community wouldn't have to implement our own one. I don't know what the implications of trusting the client to sync the peds are, though. A player who's in charge of ped sync could be running an annoying ped AI mod and wreak havoc.<br />
2. Letting the server sync the peds provides a uniform ped AI for all players. However, we would have to implement the ped AI by ourselves.<br />
<br />
My personal opinion is that we're better off going with server-side NPCs.<br />
[*]The paths can be extracted from the <a href="https://gta.fandom.com/wiki/Paths_(GTA_SA)" target="_blank" rel="noopener" class="mycode_url">game files</a>.<br />
[*]Ped AI shouldn't be too difficult to implement. Vehicle AI is definitely more challenging.
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
<strong>RE: Population Sync</strong> - <a href="member93c4.html?action=profile&amp;uid=92">LaszloR1</a> -  <strong>2020-09-13</strong>
<br />
<br />
I wouldn't trust the client with handling population sync either. Would be way too easy to spoof and cause havoc. Using decompiled scripts it would be possible to recreate ped AI. Although a few limitations exist at the moment which are: One client can only show up to 51 NPCs (Actors) and a server can only have 1000 of them.
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
<strong>RE: Population Sync</strong> - <a href="member81f8.html?action=profile&amp;uid=340">Sasino97</a> -  <strong>2020-09-14</strong>
<br />
<br />
<blockquote class="mycode_quote"><cite><span> (2020-09-11, 10:43 AM)</span>Manyula Wrote:  <a href="showthreadda22.html?pid=7902#pid7902" class="quick_jump"></a></cite>If I remember correctly, the main reason why we got recorded NPCs was because Kalcor didn't want to put ped sync into the hands of the clients</blockquote><br />
<blockquote class="mycode_quote"><cite><span> (2020-09-13, 11:58 AM)</span>LaszloR1 Wrote:  <a href="showthread7d0e.html?pid=7904#pid7904" class="quick_jump"></a></cite>I wouldn't trust the client with handling population sync either. Would be way too easy to spoof and cause havoc.</blockquote><br />
FiveM has been doing basically the same thing; yeah some people tried to cheat by creating fake peds and manipulating them, ok, but with frequent updates that problem doesn't exist. There is no problem in letting clients be the brains of peds if there are systems put in place to prevent spoofing and frequent updates to deter hackers from building those programs.
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
<strong>RE: Population Sync</strong> - <a href="memberf3df.html?action=profile&amp;uid=5">JustMichael</a> -  <strong>2020-09-15</strong>
<br />
<br />
It's definitely possible to do this, and the server doesn't need the game files, we could maybe down the line re-implement this ourselves using our system, or we could find a way to piggy back off the current implementation and yet still have the server be in charge of sync. <br />
<br />
It's not impossible, it's just quite a big task to do, and it's not going to be a priority for us. However since the idea of open.mp is to be open source eventually, the whole community is freely available to contribute help towards making this possible.
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
<strong>RE: Population Sync</strong> - <a href="memberc8dd.html?action=profile&amp;uid=221">Manyula</a> -  <strong>2020-09-15</strong>
<br />
<br />
I always assumed the game's implementation couldn't be used because the server doesn't run an instance of the game. So, would those peds be any different from regular NPCs then? And while we're on the subject of contributing: Do you guys have a contribution guide in place?
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
<strong>RE: Population Sync</strong> - <a href="member93c4.html?action=profile&amp;uid=92">LaszloR1</a> -  <strong>2020-09-16</strong>
<br />
<br />
<blockquote class="mycode_quote"><cite><span> (2020-09-15, 07:56 PM)</span>Manyula Wrote:  <a href="showthreadae6b.html?pid=7907#pid7907" class="quick_jump"></a></cite>I always assumed the game's implementation couldn't be used because the server doesn't run an instance of the game. So, would those peds be any different from regular NPCs then? And while we're on the subject of contributing: Do you guys have a contribution guide in place?</blockquote><br />
NPCs arent made out of miracle dust. You don't need the game to run it to have a population system. They are just very basic AI that follow paths and react to what is happening around them and to them.
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
<strong>RE: Population Sync</strong> - <a href="membera81f.html?action=profile&amp;uid=2807">CJ101</a> -  <strong>2020-10-12</strong>
<br />
<br />
I support this completely. Ive always wanted this.
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
<strong>RE: Population Sync</strong> - <a href="member0f98.html?action=profile&amp;uid=197">Ezio_Auditore</a> -  <strong>2020-12-21</strong>
<br />
<br />
Damn, I've always wanted something like that. Adding peds would be such a huge leap for the mod and it would add those singleplayer vibes it could made the mod more popular towards GTA SA's nostalgics. Years ago, when I discovered SA-MP, I've been excited by the possibility of a real multiplayer on San Andreas but even disappointed for the dearth of SP features. And the lack of pedastrians was by far the most disappointing one.
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --></td>
</tr>
</table>
</body>
</html>
<!-- end: printthread -->